<!-- src/app/flight-search/flight-search.component.html -->

<h1>Flight Search</h1>

<form #form="ngForm" [roundTrip]="['from','to']">
  <div class="form-group">
    <label>From *:</label>
    <input [(ngModel)]="from"
           [ngModelOptions]="{ updateOn: 'blur' }"
           name="from"
           class="form-control"
           required="required"
           minlength="3"
           maxlength="15"
           pattern="[a-zA-ZäöüÄÖÜß ]*"
           asyncCity>
  </div>

  <app-flight-validation-errors *ngIf="form.controls['from']?.dirty"
                                fieldLabel="From"
                                [errors]="form.controls['from'].errors" />

  <div *ngIf="form.controls['from']?.pending">... Executing Async Validator ...</div>

  <div class="form-group">
    <label>To *:</label>
    <input [(ngModel)]="to"
           [ngModelOptions]="{ updateOn: 'blur' }"
           name="to"
           class="form-control"
           required="required"
           minlength="3"
           maxlength="15"
           pattern="[a-zA-ZäöüÄÖÜß ]*">
  </div>

  <app-flight-validation-errors *ngIf="form.controls['to']?.dirty"
                                fieldLabel="To"
                                [errors]="form.controls['to'].errors" />

  <div class="form-group">
    <input [(ngModel)]="delayFilter" id="delayFilter" type="checkbox" name="delayFilter">
    <label for="delayFilter">Delayed</label>
  </div>

  <app-flight-validation-errors [errors]="form.errors" [fieldLabel]="'Form'" />

  <div class="form-group" *ngIf="flights$ | async as flights">
    <button (click)="search()" class="btn btn-default">
      Search
    </button>

    <button *ngIf="flights.length > 0" (click)="delay()" class="btn btn-default">
      Delay
    </button>

    <div *ngIf="flights.length > 0">
      {{ flights.length }} flights found!
    </div>
  </div>
</form>


<div class="row">
  <div *ngFor="let f of flights$ | async" class="col-xs-12 col-sm-6 col-md-4 col-lg-4 col-xl-3">
    <app-flight-card [(selected)]="basket[f.id]" [item]="f" />
  </div>
</div>

<b>Basket</b>
<pre>{{ basket | json }}</pre>
